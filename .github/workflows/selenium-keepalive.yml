name: Keep Streamlit App Alive (Selenium)

on:
  schedule:
    - cron: "*/30 * * * *"  # 每 30 分鐘執行一次
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser chromium-chromedriver python3 python3-pip
          pip install selenium

      - name: Keep Streamlit app awake
        env:
          STREAMLIT_URL: https://seatlive-frontend-q9bnxuvhjwuowj24ayvc7p.streamlit.app
        run: |
          python3 - <<EOF
          import os
          import time
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from selenium.webdriver.chrome.options import Options

          url = os.getenv("STREAMLIT_URL")
          print(f"Opening {url} ...")

          options = Options()
          options.add_argument("--headless")
          options.add_argument("--no-sandbox")
          options.add_argument("--disable-dev-shm-usage")

          driver = webdriver.Chrome(service=Service("/usr/bin/chromedriver"), options=options)
          driver.get(url)

          print("Waiting for page to load...")
          time.sleep(10)
          print("Page loaded successfully.")
          driver.quit()
          EOF
