name: Keep Streamlit App Alive (Selenium)

on:
  schedule:
    - cron: "*/30 * * * *"  # 每 30 分鐘執行一次
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser chromium-chromedriver python3 python3-pip
          pip install selenium

      - name: Keep Streamlit app awake
        env:
          STREAMLIT_URL: https://seatlive-frontend-q9bnxuvhjwuowj24ayvc7p.streamlit.app
        run: |
          python3 << 'EOF'
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from selenium.webdriver.chrome.options import Options
          import time

          options = Options()
          options.add_argument("--headless")
          options.add_argument("--no-sandbox")
          options.add_argument("--disable-dev-shm-usage")

          print(f"Opening { {STREAMLIT_URL} } ...")
          driver = webdriver.Chrome(service=Service("/usr/bin/chromedriver"), options=options)
          driver.get("${{ env.STREAMLIT_URL }}")

          print("Waiting for page to load...")
          time.sleep(20)  # 等待載入，確保建立 WebSocket
          print("Page loaded successfully.")
          driver.quit()
          EOF
